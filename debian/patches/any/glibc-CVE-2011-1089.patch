From e1fb097f447a89aa69a926e45e673a52d86a6c57 Mon Sep 17 00:00:00 2001
From: Ulrich Drepper <drepper@gmail.com>
Date: Wed, 11 May 2011 23:37:25 -0400
Subject: [PATCH] Report write error  in addmnt even for cached streams.

CVE-2011-1089

[Ubuntu note: patch differs from upstream in that changes to the NEWS
 and Changelog files were dropped to minimize patching conflicts.]

---
 misc/mntent_r.c |    6 +++---
 3 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/misc/mntent_r.c b/misc/mntent_r.c
index 9598528..6959f0e 100644
--- a/misc/mntent_r.c
+++ b/misc/mntent_r.c
@@ -263,8 +263,8 @@ __addmntent (FILE *stream, const struct mntent *mnt)
 		   mntcopy.mnt_type,
 		   mntcopy.mnt_opts,
 		   mntcopy.mnt_freq,
-		   mntcopy.mnt_passno)
-	  < 0 ? 1 : 0);
+		   mntcopy.mnt_passno) < 0
+	  || fflush (stream) != 0);
 }
 weak_alias (__addmntent, addmntent)
 
-- 
1.7.3.4

