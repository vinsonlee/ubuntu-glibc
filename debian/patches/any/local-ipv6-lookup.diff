--- sysdeps/posix/getaddrinfo.c~	2008-03-06 16:51:23.793167849 +0100
+++ sysdeps/posix/getaddrinfo.c	2008-03-06 17:06:36.696938795 +0100
@@ -263,7 +263,7 @@
 static int
 gaih_inet (const char *name, const struct gaih_service *service,
 	   const struct addrinfo *req, struct addrinfo **pai,
-	   unsigned int *naddrs)
+	   unsigned int *naddrs, bool usable_ipv6)
 {
   const struct gaih_typeproto *tp = gaih_inet_typeproto;
   struct gaih_servtuple *st = (struct gaih_servtuple *) &nullserv;
@@ -706,7 +706,7 @@
 	      if (fct != NULL)
 		{
 		  if (req->ai_family == AF_INET6
-		      || req->ai_family == AF_UNSPEC)
+		      || (req->ai_family == AF_UNSPEC && usable_ipv6))
 		    {
 		      gethosts (AF_INET6, struct in6_addr);
 		      no_inet6_data = no_data;
@@ -1905,7 +1905,7 @@
   if (hints->ai_family == AF_UNSPEC || hints->ai_family == AF_INET
       || hints->ai_family == AF_INET6)
     {
-      last_i = gaih_inet (name, pservice, hints, end, &naddrs);
+      last_i = gaih_inet (name, pservice, hints, end, &naddrs, seen_ipv6);
       if (last_i != 0)
 	{
 	  freeaddrinfo (p);
--- sysdeps/unix/sysv/linux/check_pf.c~	2008-03-06 16:51:24.073172073 +0100
+++ sysdeps/unix/sysv/linux/check_pf.c	2008-03-06 17:08:00.978210159 +0100
@@ -181,7 +181,8 @@
 		    }
 		  else
 		    {
-		      if (!IN6_IS_ADDR_LOOPBACK (address))
+		      if (!IN6_IS_ADDR_LOOPBACK (address ?: local) &&
+			  ifam->ifa_scope < RT_SCOPE_LINK)
 			*seen_ipv6 = true;
 		    }
 		}
